
@{
    ViewBag.Title = "Manage_Service";
    Layout = "~/Views/Shared/_ServiceLayout.cshtml";
}

<br /><br /><br /><br /><br />
<div id="ajaxgrid" class="container">
    <h2>Manage Service</h2>
    @{
        var gridview = new WebGrid(ViewBag.Services, ajaxUpdateContainerId: "ajaxgrid", rowsPerPage: 7);
    }
    @gridview.GetHtml(
       tableStyle: "webGrid", headerStyle: "header", alternatingRowStyle: "altColor", selectedRowStyle: "clickable",
    columns: new[]
{


     gridview.Column(columnName:"ServiceName", header: "Service Name",format: @<span>
        <span id="ServiceName" class="read">@item.ServiceName</span>
        @Html.TextBox("txtServiceName", (string)item.ServiceName, new { @class = "edit",@style="display:none" })
        <label id="label1" class="text-danger"></label>
    </span>),
    gridview.Column(columnName:"DeliveryCharge", header: "Delivery Charge",format: @<span>
        <span id="DeliveryCharge" class="read">@String.Format("{0:0.00}", (decimal)(item.DeliveryCharge))</span>
        @Html.TextBox("txtDeliveryCharge", (decimal)item.DeliveryCharge, new { @class = "edit" ,@style="display:none" })
        <label id="label2" class="text-danger"></label>
    </span>),

     gridview.Column(columnName: "ServiceDesc", header: " Service Description", format: @<span>
        <span id="ServiceDesc" class="read">@item.ServiceDesc</span>
        @Html.TextBox("txtServiceDesc", (string)item.ServiceDesc, new { @class = "edit",@style="display:none" })
        <label id="label3" class="text-danger"></label>
    </span> ),
         gridview.Column(columnName: "LocationName", header: "Available Locations", format: @<span>
        <span id="LocationName" class="unread">@item.LocationName</span>
    </span> ),
        gridview.Column(columnName: "ProductName", header: "Produtcs", format: @<span>
        <span id="ProductName" class="unread">@item.ProductName</span>
    </span> ), gridview.Column("", style: "button",
                format:

                @<text>
                    <button class="edit-case read btn btn-default btn-sm" id="@item.ServiceId"><span class="glyphicon glyphicon-pencil"></span>EDIT</button>
                    <button class="delete-case read btn btn-default btn-sm" id="@item.ServiceId">
                        <span class="glyphicon glyphicon-trash"></span>  DELETE
                    </button>
                    <button class="update-case edit btn btn-default btn-sm" id="@item.ServiceId" style="display:none;">UPDATE</button>
                    <button class="cancel-case edit btn btn-default btn-sm" id="@item.ServiceId">CANCEL</button>
                </text>),

    }
)
</div>
<style type="text/css">
    /*.webgrid-table {
        font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
        font-size: 1.2em;
        width: 100%;
        display: table;
        border-collapse: separate;
        border: solid 1px #000000;
        background-color: white;
    }

        .webgrid-table td, th {
            border: 1px solid #000000;
            padding: 3px 7px 2px;
        }

    .webgrid-header {
        background-color: #000000;
        color: #ffffff !important;
        padding-bottom: 4px;
        padding-top: 5px;
        text-align: left;
    }

    .webgrid-footer {
    }

    .webgrid-row-style {
        padding: 3px 7px 2px;*/
    .webGrid {
        border: 1px solid;
        margin-top: 30px;
        width: 1200px;
    }

        .webGrid tr {
            border: 1px solid #C0C0C0;
            height: 50px;
        }

            .webGrid tr:hover {
                background-color: #F5F5F5;
            }

        .webGrid th, .webGrid td {
            padding-left: 20px;
            width: 50px;
            border: 1px solid #C0C0C0;
        }



    .header {
        background-color: #E5E7E9;
        height: 40px;
        margin-left: 10px;
    }

        .header th {
            border: 1px solid #C0C0C0;
            padding-left: 20px;
        }

    .altColor {
        background-color: lightgray;
    }

    .btn {
        padding: 10px 24px;
        box-shadow: 0 1px 1px 0 rgba(0,0,0,0.24),0 1px 1px 0 rgba(0,0,0,0.19);
    }


    .clickable {
        cursor: pointer;
        background: #ffff99;
    }
</style>
<script src="~/scripts/jquery-1.10.2.min.js"></script>
<script src="~/scripts/jquery.validate.min.js"></script>
<script src="~/scripts/jquery.validate.unobtrusive.min.js"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.9/jquery-ui.js" type="text/javascript"></script>
<link href="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.9/themes/blitzer/jquery-ui.css"
      rel="stylesheet" type="text/css" />
@*<script src="~/scripts/Service.js"></script>*@
<script>
    $(document).ready(function () {
        $('.edit').hide();
        $(".edit-case").on("click", function () {
            var tr = $(this).parents('tr:first');
            var ServiceId = tr.find('#ServiceId').text();
            var ServiceName = tr.find('#ServiceName').text();
            var DeliveryCharge = tr.find('#DeliveryCharge').text();
            var ServiceDesc = tr.find('#ServiceDesc').text();
            tr.find('#txtServiceId').val(ServiceId);
            tr.find('#txtServiceName').val(ServiceName);
            tr.find('#txtDeliveryCharge').val(DeliveryCharge);
            tr.find('#txtServiceDesc').val(ServiceDesc);
            tr.find('.edit, .read').toggle();
        });
        $('.update-case').on('click', function (e) {
            e.preventDefault();
            var tr = $(this).parents('tr:first');
            ServiceId = $(this).prop('id');
            var ServiceName = tr.find('#txtServiceName').val();
            var DeliveryCharge = tr.find('#txtDeliveryCharge').val();
            var ServiceDesc = tr.find('#txtServiceDesc').val();
            var LocationName = tr.find('#LocationName').text();
            var ProductName = tr.find('#ProductName').text();
            if (ServiceName == "") {
                tr.find('#label1').html("Field cannot be empty");
                return false;
            }
            if (DeliveryCharge == "") {
                tr.find('#label2').html("Field cannot be empty");
                return false;
            }
            if (ServiceDesc == "") {
                tr.find('#label3').html("Field cannot be empty");
                return false;
            }
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "/Service/ServiceEdit",
                data: JSON.stringify({ "ServiceId": ServiceId, "ServiceName": ServiceName, "DeliveryCharge": DeliveryCharge, "ServiceDesc": ServiceDesc, "LocationName": LocationName, "ProductName": ProductName }),
                dataType: "json",
                success: function (data) {
                    tr.find('.edit, .read').toggle();
                    $('.edit').hide();
                    tr.find('#ServiceName').text(data.ServiceName);
                    tr.find('#DeliveryCharge').text(data.DeliveryCharge);
                    tr.find('#ServiceDesc').text(data.ServiceDesc);
                    tr.find('#LocationName').text(data.LocationName);
                    tr.find('#ProductName').text(data.ProductName);
                    tr.find('#label1').html("");
                    tr.find('#label2').html("");
                    tr.find('#label3').html("");
                    window.location.href = response.Url;

                },
                error: function (err) {
                    alert("error");
                }
            });
        });
        $('.cancel-case').on('click', function (e) {
            e.preventDefault();
            var tr = $(this).parents('tr:first');
            var ServiceId = $(this).prop('ServiceId');
            tr.find('#label1').html("");
            tr.find('#label2').html("");
            tr.find('#label3').html("");
            tr.find('.edit, .read').toggle();
            $('.edit').hide();
        });
        $('.delete-case').on('click', function (e) {
            e.preventDefault();
            var tr = $(this).parents('tr:first');
            var ServiceId = $(this).prop('id');
            debugger;
            $.ajax({
                url: '/Service/ServiceDelete',
                type: 'POST',
                data: { ServiceId: ServiceId },
                dataType: "json",
                success: function (response) {
                    alert('Delete success');
                    window.location.href = response.Url;
                },
                error: function () {

                    alert('Error occured during delete.');
                }
            });
        });
    });
</script>